<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Location Capture Demo - Educational Purpose</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background: #0056b3;
        }
        button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        .result {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            white-space: pre-wrap;
            font-family: monospace;
        }
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .info-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #dee2e6;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üåç Location Capture Demo</h1>
        
        <div class="warning">
            <strong>‚ö†Ô∏è Educational Purpose Only</strong><br>
            This demonstration shows how location data can be captured through web browsers. 
            This is for educational purposes to understand privacy and security implications. 
            Always obtain proper consent before accessing user location data in real applications.
        </div>

        <h2>Location Capture Functions</h2>
        <p>Click the buttons below to test different location capture methods:</p>
        
        <button onclick="captureOnce()">üìç Capture Location Once</button>
        <button onclick="startWatching()" id="watchBtn">üîÑ Start Continuous Tracking</button>
        <button onclick="stopWatching()" id="stopBtn" disabled>‚èπÔ∏è Stop Tracking</button>
        <button onclick="getDeviceInfo()">üì± Get Device Info</button>
        <button onclick="clearResults()">üóëÔ∏è Clear Results</button>
        
        <hr style="margin: 20px 0;">
        <h3>üìÅ Data Storage Management</h3>
        <button onclick="viewStoredData()">üìã View Stored Locations</button>
        <button onclick="downloadData()">üíæ Download Data</button>
        <button onclick="clearStoredData()">üóëÔ∏è Clear Stored Data</button>
        <button onclick="getStorageInfo()">‚ÑπÔ∏è Storage Info</button>

        <div id="results"></div>

        <div class="info-section">
            <h3>üõ°Ô∏è Privacy & Security Notes</h3>
            <ul>
                <li><strong>Browser Permission:</strong> Modern browsers require explicit user permission to access location</li>
                <li><strong>HTTPS Required:</strong> Location API only works on secure (HTTPS) connections</li>
                <li><strong>Accuracy Varies:</strong> GPS, Wi-Fi, and cell tower data provide different accuracy levels</li>
                <li><strong>User Control:</strong> Users can deny permission or revoke it at any time</li>
                <li><strong>Privacy Implications:</strong> Location data is highly sensitive personal information</li>
            </ul>
            
            <h3>üéØ Educational Use Cases</h3>
            <ul>
                <li>Understanding browser security models</li>
                <li>Learning about user privacy protection</li>
                <li>Demonstrating the importance of permission systems</li>
                <li>Testing location-based application features</li>
                <li>Security awareness training</li>
            </ul>
        </div>
    </div>

    <script src="location-capture.js"></script>
    <script>
        let watchId = null;
        const locationCapture = new LocationCapture();

        function displayResult(data, isError = false) {
            const resultsDiv = document.getElementById('results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `result ${isError ? 'error' : 'success'}`;
            
            const timestamp = new Date().toLocaleString();
            const header = isError ? '‚ùå Error' : '‚úÖ Success';
            
            resultDiv.innerHTML = `<strong>${header} - ${timestamp}</strong>\n${JSON.stringify(data, null, 2)}`;
            resultsDiv.appendChild(resultDiv);
            
            // Scroll to bottom
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
        }

        function captureOnce() {
            displayResult({ status: 'Requesting location permission...' });
            
            locationCapture.captureLocation(
                (data) => {
                    displayResult({
                        type: 'Single Location Capture',
                        latitude: data.latitude,
                        longitude: data.longitude,
                        accuracy: `${data.accuracy} meters`,
                        timestamp: data.timestamp,
                        additionalInfo: {
                            altitude: data.altitude,
                            speed: data.speed,
                            heading: data.heading
                        }
                    });
                },
                (error) => {
                    displayResult({
                        type: 'Location Capture Failed',
                        error: error.error,
                        code: error.code
                    }, true);
                }
            );
        }

        function startWatching() {
            if (watchId) {
                displayResult({ error: 'Already watching location' }, true);
                return;
            }

            displayResult({ status: 'Starting continuous location tracking...' });
            
            watchId = locationCapture.startWatching(
                (data) => {
                    displayResult({
                        type: 'Continuous Tracking Update',
                        latitude: data.latitude,
                        longitude: data.longitude,
                        accuracy: `${data.accuracy} meters`,
                        timestamp: data.timestamp
                    });
                },
                (error) => {
                    displayResult({
                        type: 'Tracking Error',
                        error: error.error,
                        code: error.code
                    }, true);
                }
            );

            document.getElementById('watchBtn').disabled = true;
            document.getElementById('stopBtn').disabled = false;
        }

        function stopWatching() {
            if (watchId) {
                locationCapture.stopWatching(watchId);
                watchId = null;
                displayResult({ type: 'Continuous tracking stopped' });
                
                document.getElementById('watchBtn').disabled = false;
                document.getElementById('stopBtn').disabled = true;
            }
        }

        function getDeviceInfo() {
            const deviceInfo = locationCapture.getDeviceInfo();
            displayResult({
                type: 'Device & Browser Information',
                ...deviceInfo
            });
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }

        // Storage management functions
        function viewStoredData() {
            const storedData = locationCapture.getAllStoredLocations();
            displayResult({
                type: 'Stored Location Data',
                totalLocations: storedData.length,
                data: storedData.slice(-5) // Show last 5 entries
            });
        }

        function downloadData() {
            locationCapture.downloadStoredLocations();
            displayResult({
                type: 'Data Download',
                message: 'Location data downloaded as JSON file'
            });
        }

        function clearStoredData() {
            const count = locationCapture.getAllStoredLocations().length;
            locationCapture.clearStoredLocations();
            displayResult({
                type: 'Storage Cleared',
                message: `Cleared ${count} stored location entries`
            });
        }

        function getStorageInfo() {
            const storedData = locationCapture.getAllStoredLocations();
            const storageUsed = JSON.stringify(storedData).length;
            
            displayResult({
                type: 'Storage Information',
                totalEntries: storedData.length,
                storageUsed: `${(storageUsed / 1024).toFixed(2)} KB`,
                sessionId: locationCapture.getSessionId(),
                firstCapture: storedData.length > 0 ? storedData[0].timestamp : 'None',
                lastCapture: storedData.length > 0 ? storedData[storedData.length - 1].timestamp : 'None'
            });
        }

        // Auto-capture location on page load
        window.addEventListener('load', () => {
            displayResult({
                type: 'Page Loaded - Auto-capturing location...',
                geolocationSupported: !!navigator.geolocation,
                httpsConnection: location.protocol === 'https:',
                note: 'Location API requires HTTPS in production'
            });

            // Automatically capture location when page loads
            if (navigator.geolocation) {
                setTimeout(() => {
                    captureOnce();
                }, 1000); // Small delay to ensure page is fully loaded
            } else {
                displayResult({
                    type: 'Auto-capture Failed',
                    error: 'Geolocation not supported by this browser'
                }, true);
            }
        });
    </script>
</body>
</html>
